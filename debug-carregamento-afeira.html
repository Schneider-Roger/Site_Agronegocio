<!DOCTYPE html>
<html>
<head>
    <title>Debug - Carregamento Imagens A Feira</title>
</head>
<body>
    <h1>Debug - Carregamento das Imagens A Feira</h1>
    
    <div id="debug-info">
        <h3>Informa√ß√µes de Debug:</h3>
        <div id="api-status"></div>
        <div id="imagens-info"></div>
    </div>
    
    <h3>Container de Teste (simulando index.html):</h3>
    <div class="afeira-imagens" id="afeira-imagens" style="display: flex; gap: 10px; border: 2px solid #ccc; padding: 20px;">
        <img src="assets/img/afeira1.jpg" alt="Imagem 1 da Feira" style="width: 200px; height: auto;">
        <img src="assets/img/afeira2.jpg" alt="Imagem 2 da Feira" style="width: 200px; height: auto;">
        <img src="assets/img/afeira3.jpg" alt="Imagem 3 da Feira" style="width: 200px; height: auto;">
    </div>
    
    <button onclick="testarCarregamento()">Testar Carregamento Manual</button>
    
    <script>
        async function testarCarregamento() {
            const apiStatus = document.getElementById('api-status');
            const imagensInfo = document.getElementById('imagens-info');
            const afeiraImagens = document.getElementById('afeira-imagens');
            
            try {
                console.log('[TEST] Iniciando teste de carregamento...');
                apiStatus.innerHTML = '<p>üîÑ Carregando dados da API...</p>';
                
                const response = await fetch('/api/home');
                const data = await response.json();
                
                console.log('[TEST] Dados recebidos:', data);
                apiStatus.innerHTML = '<p style="color: green;">‚úÖ API respondeu com sucesso</p>';
                
                // Informa√ß√µes das imagens
                imagensInfo.innerHTML = `
                    <h4>Dados das Imagens:</h4>
                    <p><strong>afeira_imagens existe:</strong> ${data.afeira_imagens ? 'SIM' : 'N√ÉO'}</p>
                    <p><strong>√â array:</strong> ${Array.isArray(data.afeira_imagens) ? 'SIM' : 'N√ÉO'}</p>
                    <p><strong>Quantidade:</strong> ${data.afeira_imagens ? data.afeira_imagens.length : 0}</p>
                    <p><strong>Valores:</strong></p>
                    <ul>
                        ${data.afeira_imagens ? data.afeira_imagens.map((img, i) => 
                            `<li>Imagem ${i+1}: <code>${img}</code></li>`
                        ).join('') : '<li>Nenhuma imagem</li>'}
                    </ul>
                `;
                
                // Processamento (igual ao index.html)
                console.log('[TEST] Verificando afeira_imagens:', data.afeira_imagens);
                if (data.afeira_imagens && Array.isArray(data.afeira_imagens)) {
                    console.log('[TEST] Container afeira-imagens encontrado:', afeiraImagens);
                    if (afeiraImagens) {
                        console.log('[TEST] Limpando container...');
                        afeiraImagens.innerHTML = '';
                        
                        // Filtrar apenas imagens v√°lidas (n√£o vazias ou nulas)
                        const imagensValidas = data.afeira_imagens.filter(img => img && img.trim() !== '');
                        console.log('[TEST] Imagens v√°lidas encontradas:', imagensValidas.length, imagensValidas);
                        
                        imagensValidas.slice(0, 3).forEach((img, index) => {
                            if (img && img.trim()) {
                                console.log('[TEST] Criando elemento para:', img);
                                const imgElement = document.createElement('img');
                                imgElement.src = 'http://localhost:3000' + img;
                                imgElement.alt = `Imagem ${index + 1} da Feira`;
                                imgElement.style.width = '200px';
                                imgElement.style.height = 'auto';
                                imgElement.style.border = '2px solid green';
                                
                                imgElement.onerror = function() {
                                    console.error('[TEST] ‚ùå Erro ao carregar imagem:', img);
                                    imgElement.style.border = '2px solid red';
                                };
                                imgElement.onload = function() {
                                    console.log('[TEST] ‚úÖ Imagem carregada com sucesso:', img);
                                };
                                
                                afeiraImagens.appendChild(imgElement);
                                console.log('[TEST] ‚úÖ Imagem adicionada ao DOM:', img);
                            }
                        });
                        
                        imagensInfo.innerHTML += '<p style="color: green;"><strong>‚úÖ Processamento conclu√≠do!</strong></p>';
                    }
                }
                
            } catch (error) {
                console.error('[TEST] Erro:', error);
                apiStatus.innerHTML = `<p style="color: red;">‚ùå Erro: ${error.message}</p>`;
            }
        }
        
        // Executar automaticamente ao carregar
        window.addEventListener('load', () => {
            console.log('[TEST] P√°gina carregada, executando teste autom√°tico...');
            testarCarregamento();
        });
    </script>
</body>
</html>
