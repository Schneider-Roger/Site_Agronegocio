<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Editar Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/editar-home.css">
  <link rel="stylesheet" href="assets/css/sessao-banner.css">
  <link rel="stylesheet" href="assets/css/sessao-faixa.css">
  <link rel="stylesheet" href="assets/css/sessao-afeira.css">
  <link rel="stylesheet" href="assets/css/sessao-oqueesperar.css">
  <link rel="stylesheet" href="assets/css/sessao-mapa.css">
  <link rel="stylesheet" href="assets/css/sessao-material.css">
  <link rel="stylesheet" href="assets/css/sessao-local.css">

  
</head>
<body>
  <div class="admin-layout">
    <aside class="sidebar">
      <div class="logo-container">
        <img src="assets/img/Modo_de_isolamento.png" alt="Logo da Feira">
      </div>
      <nav>
        <a href="dashboard.html"> Painel</a>
        <a href="editar-home.html"> Editar Home</a>
        <a href="editar-programacao.html"> Programa√ß√£o</a>
        <a href="gerenciar-galeria.html"> Galeria</a>
        <a href="expositores.html"> Expositores</a>
        <a href="mensagens.html"> Mensagens</a>
      </nav>
      <div class="logout-footer">
        <a href="/logout" class="logout-btn">Desconectar</a>
      </div>
    </aside>
    <main class="main-content">
      <h1>Editar P√°gina Inicial</h1>
      <div class="form-box">
        <form id="form-editar-home">
          <!-- ===================== Sess√£o Banner ===================== -->
          <div class="banner-section">
            <h2>Banner</h2>
            <div class="form-group">
              <label for="banner">Imagem do Banner</label>
              <input type="file" id="banner" name="banner" accept="image/*">
              <div id="banner-preview" class="image-preview"></div>
            </div>

          </div>
          <link rel="stylesheet" href="assets/css/sessao-banner.css">

          <!-- ===================== Sess√£o Contador Data ===================== -->
          <div class="contador-data-section">
            <h2>Contador com Data</h2>
            <div class="form-section">
              <label for="contador_data_feira">Data da Feira</label>
              <input type="datetime-local" id="contador_data_feira" name="contador_data_feira">
            </div>
            <div class="form-section">
              <label for="contador_data_ative">
                <input type="checkbox" id="contador_data_ativo" name="contador_data_ativo" checked>
                Exibir se√ß√£o contador na p√°gina inicial
              </label>
            </div>
            <!-- Bot√£o para zerar contador -->
            <div class="zerar-contador-container">
              <button type="button" id="zerar-contador-btn">
                Zerar Contador
              </button>
            </div>

            <!-- Status de sucesso/erro -->
            <div id="contador-data-status" class="contador-data-status"></div>
          </div>

          <link rel="stylesheet" href="assets/css/sessao-contador-data.css">
        
          <!-- ===================== Sess√£o Faixa Abaixo do Banner ===================== -->
          <div class="faixa-section">
            <h2>Faixa abaixo do Banner</h2>
            <div class="form-section">
              <label for="faixa_titulo">T√≠tulo da Faixa</label>
              <input type="text" id="faixa_titulo" name="faixa_titulo" maxlength="100">
            </div>
            <div class="form-section">
              <label for="faixa_texto">Texto da Faixa</label>
              <textarea id="faixa_texto" name="faixa_texto" rows="3" maxlength="300"></textarea>
            </div>
            <div class="form-section">
              <label for="faixa_botao_texto">Texto do Bot√£o</label>
              <input type="text" id="faixa_botao_texto" name="faixa_botao_texto" maxlength="50">
            </div>
            <div class="form-section">
              <label for="faixa_botao_url">URL do Bot√£o</label>
              <input type="text" id="faixa_botao_url" name="faixa_botao_url" maxlength="200">
            </div>
            <div class="form-section">
              <label for="faixa_botao_ativo">
                <input type="checkbox" id="faixa_botao_ativo" name="faixa_botao_ativo" checked>
                Exibir bot√£o na faixa
              </label>
            </div>

          </div>

          <link rel="stylesheet" href="assets/css/sessao-faixa.css">

          


          <!-- ===================== Sess√£o A Feira ===================== -->
          <div class="afeira-section">
            <h2>Sess√£o "A Feira"</h2>
            <div class="form-section">
              <label for="afeira_titulo">T√≠tulo da Sess√£o "A Feira"</label>
              <input type="text" id="afeira_titulo" name="afeira_titulo" maxlength="100">
            </div>
            <div class="form-section">
              <label for="afeira_texto">Texto da Sess√£o "A Feira"</label>
              <textarea id="afeira_texto" name="afeira_texto" rows="6" maxlength="1500"></textarea>
            </div>
            <div class="form-section">
              <label>Imagem 1 da Sess√£o "A Feira" <span id="afeira-status-1" class="image-status"></span></label>
              <input type="file" id="afeira_imagem1" name="afeira_imagem1" accept="image/*">
              <div class="afeira-imagem-preview" id="afeira-imagem1-preview"></div>
            </div>
            <div class="form-section">
              <label>Imagem 2 da Sess√£o "A Feira" <span id="afeira-status-2" class="image-status"></span></label>
              <input type="file" id="afeira_imagem2" name="afeira_imagem2" accept="image/*">
              <div class="afeira-imagem-preview" id="afeira-imagem2-preview"></div>
            </div>
            <div class="form-section">
              <label>Imagem 3 da Sess√£o "A Feira" <span id="afeira-status-3" class="image-status"></span></label>
              <input type="file" id="afeira_imagem3" name="afeira_imagem3" accept="image/*">
              <div class="afeira-imagem-preview" id="afeira-imagem3-preview"></div>
            </div>
          </div>
          <!-- ===================== Sess√£o O QUE ESPERAR ===================== -->
          <div class="oqueesperar-section">
            <h2>Sess√£o "O QUE ESPERAR"</h2>
            <div class="form-section">
              <label for="oqueesperar_titulo">T√≠tulo da Sess√£o "O QUE ESPERAR"</label>
              <input type="text" id="oqueesperar_titulo" name="oqueesperar_titulo" maxlength="100">
            </div>
            <div class="form-section">
              <label>Cards da Sess√£o "O QUE ESPERAR"</label>
              <div class="oqueesperar-cards-admin">
                <!-- 8 cards -->
                <div class="oqueesperar-card-admin">
                  <input type="text" name="oqueesperar_card1_texto" id="oqueesperar_card1_texto" placeholder="Texto do Card 1" maxlength="250">
                  <input type="file" name="oqueesperar_card1_img" id="oqueesperar_card1_img" accept="image/*">
                  <div class="oqueesperar-card-preview" id="oqueesperar_card1_preview"></div>
                </div>
                <div class="oqueesperar-card-admin">
                  <input type="text" name="oqueesperar_card2_texto" id="oqueesperar_card2_texto" placeholder="Texto do Card 2" maxlength="250">
                  <input type="file" name="oqueesperar_card2_img" id="oqueesperar_card2_img" accept="image/*">
                  <div class="oqueesperar-card-preview" id="oqueesperar_card2_preview"></div>
                </div>
                <div class="oqueesperar-card-admin">
                  <input type="text" name="oqueesperar_card3_texto" id="oqueesperar_card3_texto" placeholder="Texto do Card 3" maxlength="250">
                  <input type="file" name="oqueesperar_card3_img" id="oqueesperar_card3_img" accept="image/*">
                  <div class="oqueesperar-card-preview" id="oqueesperar_card3_preview"></div>
                </div>
                <div class="oqueesperar-card-admin">
                  <input type="text" name="oqueesperar_card4_texto" id="oqueesperar_card4_texto" placeholder="Texto do Card 4" maxlength="250">
                  <input type="file" name="oqueesperar_card4_img" id="oqueesperar_card4_img" accept="image/*">
                  <div class="oqueesperar-card-preview" id="oqueesperar_card4_preview"></div>
                </div>
                <div class="oqueesperar-card-admin">
                  <input type="text" name="oqueesperar_card5_texto" id="oqueesperar_card5_texto" placeholder="Texto do Card 5" maxlength="250">
                  <input type="file" name="oqueesperar_card5_img" id="oqueesperar_card5_img" accept="image/*">
                  <div class="oqueesperar-card-preview" id="oqueesperar_card5_preview"></div>
                </div>
                <div class="oqueesperar-card-admin">
                  <input type="text" name="oqueesperar_card6_texto" id="oqueesperar_card6_texto" placeholder="Texto do Card 6" maxlength="250">
                  <input type="file" name="oqueesperar_card6_img" id="oqueesperar_card6_img" accept="image/*">
                  <div class="oqueesperar-card-preview" id="oqueesperar_card6_preview"></div>
                </div>
                <div class="oqueesperar-card-admin">
                  <input type="text" name="oqueesperar_card7_texto" id="oqueesperar_card7_texto" placeholder="Texto do Card 7" maxlength="250">
                  <input type="file" name="oqueesperar_card7_img" id="oqueesperar_card7_img" accept="image/*">
                  <div class="oqueesperar-card-preview" id="oqueesperar_card7_preview"></div>
                </div>
                <div class="oqueesperar-card-admin">
                  <input type="text" name="oqueesperar_card8_texto" id="oqueesperar_card8_texto" placeholder="Texto do Card 8" maxlength="250">
                  <input type="file" name="oqueesperar_card8_img" id="oqueesperar_card8_img" accept="image/*">
                  <div class="oqueesperar-card-preview" id="oqueesperar_card8_preview"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- ===================== Sess√£o Mapa da Feira ===================== -->
          <div class="mapa-section">
            <h2>Mapa da Feira</h2>
            <div class="form-section">
              <label for="mapa_imagem">Imagem do Mapa</label>
              <input type="file" id="mapa_imagem" name="mapa_imagem" accept="image/*,application/pdf">
              <div class="mapa-preview" id="mapa-preview"></div>
              <small>Voc√™ pode enviar uma imagem (JPG, PNG) ou PDF. O arquivo ser√° exibido e disponibilizado para download no site.</small>
            </div>
          </div>

          <!-- ===================== Sess√£o Material Oficial ===================== -->
          <div class="material-section">
            <h2>Material Oficial</h2>
            <div class="form-section">
              <label for="material_manual">Manual do Expositor</label>
              <input type="file" id="material_manual" name="material_manual" accept=".pdf,.doc,.docx,.zip,.rar">
              <div class="material-preview" id="material-manual-preview"></div>
              <small>Arquivo do Manual do Expositor (PDF, DOC, DOCX, ZIP, RAR). Ser√° disponibilizado para download no site.</small>
            </div>
            <div class="form-section">
              <label for="material_release">Release de Imprensa</label>
              <input type="file" id="material_release" name="material_release" accept=".pdf,.doc,.docx,.zip,.rar">
              <div class="material-preview" id="material-release-preview"></div>
              <small>Arquivo do Release de Imprensa (PDF, DOC, DOCX, ZIP, RAR). Ser√° disponibilizado para download no site.</small>
            </div>
          </div>
          <!-- ===================== Sess√£o LOCAL ===================== -->
          <div class="local-section">
            <h2>Local</h2>
            <div class="form-section">
              <label for="local_endereco">Endere√ßo do Evento</label>
              <input type="text" id="local_endereco" name="local_endereco" maxlength="200" placeholder="Digite o endere√ßo completo do evento">
            </div>
            <div class="form-section">
              <label for="local_maps_url">Link do Google Maps</label>
              <input type="url" id="local_maps_url" name="local_maps_url" maxlength="300" placeholder="Cole aqui o link do Google Maps">
              <small>O endere√ßo e o link ser√£o exibidos no site p√∫blico para facilitar a localiza√ß√£o do evento.</small>
            </div>
          </div>

          <!-- ===================== Bot√£o Final - Salvar Todas as Altera√ß√µes ===================== -->
          <div style="text-align:center; margin: 32px 0 0 0;">
            <button type="submit" class="btn btn-solid" style="font-size:1.2em;padding:14px 40px;">Salvar Altera√ß√µes</button>
          </div>
          </div>
          <!-- Sess√£o Programa√ß√£o -->
          <!-- ATEN√á√ÉO: A sess√£o de programa√ß√£o foi removida deste formul√°rio.
               A edi√ß√£o da programa√ß√£o ser√° feita em uma nova p√°gina dedicada (ex: editar-programacao.html).
               O backend e o restante do admin permanecem funcionando normalmente. -->
          <!-- (toda a estrutura HTML e JS da programa√ß√£o foi removida deste arquivo) -->
          <!-- =====================
          PREVIEW DE IMAGENS
          ===================== -->
          <script>
          // DEBUG: Preview do banner
          console.log('[DEBUG] Script de preview de imagens carregado');
          
          // Preview para arquivos da se√ß√£o "Material Oficial"
          document.getElementById('material_manual').addEventListener('change', function(e) {
            console.log('[DEBUG] Manual do Expositor alterado:', this.files);
            const preview = document.getElementById('material-manual-preview');
            preview.innerHTML = '';
            if (this.files && this.files[0]) {
              const file = this.files[0];
              const fileSize = (file.size / 1024 / 1024).toFixed(2);
              const fileExtension = file.name.split('.').pop().toLowerCase();
              
              let fileIcon = 'üìÑ';
              if (fileExtension === 'pdf') fileIcon = 'üìã';
              else if (['doc', 'docx'].includes(fileExtension)) fileIcon = 'üìù';
              else if (['zip', 'rar'].includes(fileExtension)) fileIcon = 'üì¶';
              
              preview.innerHTML = `
                <div class="file-info">
                  <div class="file-icon">${fileIcon}</div>
                  <div class="file-details">
                    <div class="file-name">${file.name}</div>
                    <div class="file-size">${fileSize} MB</div>
                  </div>
                </div>
              `;
            }
          });
          
          document.getElementById('material_release').addEventListener('change', function(e) {
            console.log('[DEBUG] Release de Imprensa alterado:', this.files);
            const preview = document.getElementById('material-release-preview');
            preview.innerHTML = '';
            if (this.files && this.files[0]) {
              const file = this.files[0];
              const fileSize = (file.size / 1024 / 1024).toFixed(2);
              const fileExtension = file.name.split('.').pop().toLowerCase();
              
              let fileIcon = 'üìÑ';
              if (fileExtension === 'pdf') fileIcon = 'üìã';
              else if (['doc', 'docx'].includes(fileExtension)) fileIcon = 'üìù';
              else if (['zip', 'rar'].includes(fileExtension)) fileIcon = 'üì¶';
              
              preview.innerHTML = `
                <div class="file-info">
                  <div class="file-icon">${fileIcon}</div>
                  <div class="file-details">
                    <div class="file-name">${file.name}</div>
                    <div class="file-size">${fileSize} MB</div>
                  </div>
                </div>
              `;
            }
          });
          
          // Preview para imagens da sess√£o "A Feira"
          // Adiciona listeners para cada input individual
          document.getElementById('afeira_imagem1').addEventListener('change', function(e) {
            console.log('[DEBUG] Imagem 1 da Feira alterada:', this.files);
            const preview = document.getElementById('afeira-imagem1-preview');
            preview.innerHTML = '';
            if (this.files && this.files[0]) {
              const img = document.createElement('img');
              img.src = URL.createObjectURL(this.files[0]);
              preview.appendChild(img);
            }
          });
          
          document.getElementById('afeira_imagem2').addEventListener('change', function(e) {
            console.log('[DEBUG] Imagem 2 da Feira alterada:', this.files);
            const preview = document.getElementById('afeira-imagem2-preview');
            preview.innerHTML = '';
            if (this.files && this.files[0]) {
              const img = document.createElement('img');
              img.src = URL.createObjectURL(this.files[0]);
              preview.appendChild(img);
            }
          });
          
          document.getElementById('afeira_imagem3').addEventListener('change', function(e) {
            console.log('[DEBUG] Imagem 3 da Feira alterada:', this.files);
            const preview = document.getElementById('afeira-imagem3-preview');
            preview.innerHTML = '';
            if (this.files && this.files[0]) {
              const img = document.createElement('img');
              img.src = URL.createObjectURL(this.files[0]);
              preview.appendChild(img);
            }
          });
          // Preview para os cards da sess√£o "O QUE ESPERAR"
          for (let i = 1; i <= 8; i++) {
            document.getElementById(`oqueesperar_card${i}_img`).addEventListener('change', function(e) {
              // DEBUG: Preview do card alterado
              console.log(`[DEBUG] Card ${i} alterado:`, this.files);
              const preview = document.getElementById(`oqueesperar_card${i}_preview`);
              preview.innerHTML = '';
              if (this.files && this.files[0]) {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(this.files[0]);
                preview.appendChild(img);
              }
            });
          }
          // Preview do mapa da feira
          // DEBUG: Preview do mapa

          document.getElementById('mapa_imagem').addEventListener('change', function(e) {
            // DEBUG: Preview do mapa alterado
            console.log('[DEBUG] Mapa alterado:', this.files);
            const preview = document.getElementById('mapa-preview');
            preview.innerHTML = '';
            if (this.files && this.files[0]) {
              const file = this.files[0];
              if (file.type === 'application/pdf') {
                preview.innerHTML = `<span style='color:#994C11;font-weight:bold;'>Arquivo PDF selecionado: ${file.name}</span>`;
              } else {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.style.maxWidth = '100%';
                img.style.height = 'auto';
                img.style.maxHeight = '700px';
                img.style.width = 'auto';
                img.style.display = 'block';
                img.style.margin = '0 auto';
                img.style.borderRadius = '16px';
                img.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                img.style.objectFit = 'contain';
                preview.appendChild(img);
              }
            }
          });
          // =====================
          // INTEGRA√á√ÉO COM BACKEND
          // =====================
          // O carregamento de dados foi movido para editar-home.js para evitar duplica√ß√£o
          // O submit tamb√©m foi movido para editar-home.js para evitar conflitos
          // =====================
// Fun√ß√£o utilit√°ria para adicionar preview de imagem a um input file
// Fun√ß√£o utilit√°ria para adicionar preview de imagem a um input file
function addImagePreview(inputId, previewId, options = {}) {
  const input = document.getElementById(inputId);
  const preview = document.getElementById(previewId);
  if (!input || !preview) return;
  input.addEventListener('change', function(e) {
    preview.innerHTML = '';
    if (this.files && this.files.length > 0) {
      // Caso especial para preview de PDF (usado no mapa)
      if (options.allowPdf && this.files[0].type === 'application/pdf') {
        preview.innerHTML = `<span style='color:#994C11;font-weight:bold;'>Arquivo PDF selecionado: ${this.files[0].name}</span>`;
        return;
      }
      Array.from(this.files).forEach(file => {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        if (options.mapaStyle) {
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          img.style.maxHeight = '700px';
          img.style.width = 'auto';
          img.style.display = 'block';
          img.style.margin = '0 auto';
          img.style.borderRadius = '16px';
          img.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
          img.style.objectFit = 'contain';
        }
        preview.appendChild(img);
      });
    }
  });
}

// Aplicar preview modularizado
addImagePreview('banner', 'banner-preview');
// Preview para os cards da sess√£o "O QUE ESPERAR"
for (let i = 1; i <= 8; i++) {
  addImagePreview(`oqueesperar_card${i}_img`, `oqueesperar_card${i}_preview`);
}
// Preview do mapa da feira (imagem ou PDF)
addImagePreview('mapa_imagem', 'mapa-preview', { allowPdf: true, mapaStyle: true });
        </script>
      </div>
    </main>
  </div>
  <!-- Script inline deve ser carregado ANTES do arquivo externo -->
  <script>
    // Fazer as fun√ß√µes globais dispon√≠veis para o arquivo externo
    window.bannersCount = 0;

    // =====================================================
    // FUNCIONALIDADE CONTADOR DATA
    // =====================================================
    document.addEventListener('DOMContentLoaded', function() {
      const zerarContadorBtn = document.getElementById('zerar-contador-btn');
      const contadorDataStatus = document.getElementById('contador-data-status');

      /**
       * Mostra status de sucesso ou erro
       * @param {string} message - Mensagem a ser exibida
       * @param {string} type - Tipo do status ('success' ou 'error')
       */
      function mostrarStatus(message, type) {
        contadorDataStatus.textContent = message;
        contadorDataStatus.className = `contador-data-status ${type}`;
        contadorDataStatus.style.display = 'block';
        
        setTimeout(() => {
          contadorDataStatus.style.display = 'none';
        }, 3000);
      }

      /**
       * Zera o contador definindo a data atual
       */
      if (zerarContadorBtn) {
        zerarContadorBtn.addEventListener('click', function() {
          const agora = new Date();
          const dataFormatada = agora.toISOString().slice(0, 16); // YYYY-MM-DDThh:mm
          document.getElementById('contador_data_feira').value = dataFormatada;
          mostrarStatus('Contador zerado para a data atual!', 'success');
        });
      }
    });
  </script>
  <script src="assets/js/editar-home.js"></script>
</body>
</html>
